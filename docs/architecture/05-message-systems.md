
# 05-message-systems.md — Архитектурная справка по системам обмена сообщениями  
## Redis Pub/Sub, Redis Streams, NATS, Kafka, RabbitMQ

---

## 1. Введение

Современные распределённые системы требуют быстрых, надёжных, масштабируемых механизмов передачи событий.  
В рамках BotPlatform это особенно критично, потому что:

- Event Bus — сердце всей платформы,  
- события должны передаваться между движками, стратегиями, мониторингом и хранилищем,  
- платформа должна уметь масштабироваться без переделки архитектуры.

Далее описаны пять ключевых технологий обмена сообщениями.

---

## 2. Redis Pub/Sub

### История  
Разработан как часть Redis — сверхбыстрой in-memory БД.

### Принцип  
Простая модель:  
**publish → subscribe**, без сохранения сообщений.

### Плюсы  
- сверхпростая архитектура  
- очень быстрый  
- идеально для real-time  
- отлично подходит для внутренних сервисов

### Минусы  
- **нет хранения истории**  
- нет подтверждений доставки  
- подписчики должны быть онлайн

### Где применять  
Прототипы, локальные EventBus, простые real-time уведомления.

---

## 3. Redis Streams

### История  
Появились в Redis 5.0 как реакция на популярность Kafka.

### Принцип  
Это лог событий:  
каждое сообщение имеет ID, может быть перечитано.

### Плюсы  
- хранение истории  
- consumer groups  
- replay  
- простота API  
- сверхбыстрые

### Минусы  
- ограничено возможностями Redis  
- не масштабируется как Kafka  
- хранение в RAM + дисковый снапшот

### Где применять  
Очереди событий, state recovery, EventBus средней мощности.

---

## 4. NATS

### История  
Создан Дереком Коллисоном, ориентирован на микросервисы и облачные архитектуры.

### Принцип  
Минималистичная messaging-система: pub/sub, request/reply, очереди.  
JetStream добавляет персистентность и replay.

### Плюсы  
- ультранизкие задержки  
- простейший протокол  
- облачная масштабируемость  
- auto-healing кластеры  

### Минусы  
- JetStream сложнее освоить  
- меньше экосистема, чем Kafka

### Где применять  
Высоконагруженные real-time системы, микросервисы, распределённые движки.

---

## 5. Kafka

### История  
Создана в LinkedIn как основа для построения огромных событийных систем.

### Принцип  
Распределённый commit log.  
Producers пишут в topics → consumers читают с оффсетом.

### Плюсы  
- хранит миллиарды событий  
- горизонтальная масштабируемость  
- гарантированная доставка  
- consumer groups  
- идеально для больших компаний

### Минусы  
- тяжёлое развертывание  
- сложнее DevOps  
- задержки выше чем Redis/NATS

### Где применять  
Крупные SaaS, риск-менеджмент, аналитические и телеметрические системы.

---

## 6. RabbitMQ

### История  
Один из старейших и самых зрелых брокеров, AMQP-реализация.

### Принцип  
Работает через очереди и exchange-маршрутизацию.

### Плюсы  
- гибкая маршрутизация  
- подтверждения доставки  
- множество протоколов  
- надёжность

### Минусы  
- медленнее Redis/NATS  
- масштабируется хуже Kafka  
- сложнее модель

### Где применять  
Корпоративные рабочие процессы, интеграции, сложные маршруты сообщений.

---

## 7. Сравнительная таблица

| Система | Скорость | Хранение | Масштабирование | Сложность | Лучшее применение |
|--------|----------|-----------|------------------|-----------|------------------|
| Redis Pub/Sub | ★★★★★ | Нет | ★★☆☆☆ | ★☆☆☆☆ | Real-time без истории |
| Redis Streams | ★★★★☆ | Да | ★★★☆☆ | ★★☆☆☆ | Очереди, event log |
| NATS | ★★★★★ | JetStream | ★★★★☆ | ★★★☆☆ | Микросервисы, распределённые движки |
| Kafka | ★★★☆☆ | Да (гигантское) | ★★★★★ | ★★★★★ | Big Data, высокие нагрузки |
| RabbitMQ | ★★☆☆☆ | Да | ★★☆☆☆ | ★★★☆☆ | Корпоративные процессы |

---

## 8. Рекомендации для BotPlatform

### Старт проекта  
**InMemoryEventBus** → скорость разработки, меньше зависимостей.

### Первый этап распределённости  
**Redis Streams** как баланс простоты и надёжности.

### Рост платформы (десятки движков)  
**NATS + JetStream**  
идеален для event-driven trading-платформ.

### Предельно высокий масштаб (много пользователей, аналитика)  
**Kafka**  
используется в серьёзных трейд-системах.

---

## 9. Вывод

Для BotPlatform оптимальный путь развития:

```
InMemory → Redis Streams → NATS JetStream → Kafka (если потребуется)
```

Этот путь обеспечивает эволюцию от простой локальной разработки до промышленной многопользовательской платформы.

